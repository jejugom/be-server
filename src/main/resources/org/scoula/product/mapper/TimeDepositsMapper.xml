<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.scoula.product.mapper.TimeDepositsMapper">

    <!-- 정기예금 리스트용 ResultMap -->
    <resultMap id="TimeDepositsDTOMap" type="org.scoula.product.dto.TimeDepositsDto">
        <id property="finPrdtCd" column="fin_prdt_cd"/> <!-- 상품 코드 -->
        <result property="finPrdtNm" column="fin_prdt_nm"/> <!-- 상품명 -->
        <result property="prdtFeature" column="prdt_feature"/> <!-- 상품 특성 -->

        <!-- 옵션 리스트는 별도 쿼리로 조회 -->
        <collection property="optionList" ofType="org.scoula.product.dto.TimeDepositsDto$OptionList"
                    select="findOptionsByFinPrdtCd" column="fin_prdt_cd"/>
    </resultMap>

    <!-- 정기예금 옵션 리스트용 ResultMap -->
    <resultMap id="OptionListMap" type="org.scoula.product.dto.TimeDepositsDto$OptionList">
        <result property="saveTrm" column="save_trm"/> <!-- 저축 기간 -->
        <result property="intrRate" column="intr_rate"/> <!-- 기본 금리 -->
        <result property="intrRate2" column="intr_rate2"/> <!-- 최고 금리 -->
    </resultMap>

    <!-- 정기예금 상세조회용 ResultMap -->
    <resultMap id="timeDepositDetailMap" type="org.scoula.product.dto.TimeDepositsDetailDto">
        <result column="fin_prdt_cd" property="finPrdtCd"/> <!-- 상품 코드 -->
        <result column="fin_prdt_category" property="finPrdtCategory"/> <!-- 상품 분류 -->
        <result column="fin_prdt_nm" property="finPrdtNm"/> <!-- 상품명 -->
        <result column="rec_reason" property="recReason"/> <!-- 추천 사유 -->
        <result column="kor_co_nm" property="korCoNm"/> <!-- 금융회사명 -->
        <result column="prdt_feature" property="prdtFeature"/> <!-- 상품 특성 -->
        <result column="description" property="description"/> <!-- 상품 설명 -->
        <result column="join_way" property="joinWay"/> <!-- 가입 방법 -->
        <result column="mtrt_int" property="mtrtInt"/> <!-- 만기 후 이자율 -->
        <result column="spcl_cnd" property="spclCnd"/> <!-- 우대 조건 -->
        <result column="join_deny" property="joinDeny"/> <!-- 가입 제한 여부 -->
        <result column="join_member" property="joinMember"/> <!-- 가입 대상 -->
        <result column="etc_note" property="etcNote"/> <!-- 기타 유의사항 -->
        <result column="max_limit" property="maxLimit"/> <!-- 최고 한도 -->
        <result column="tendency" property="tendency"/> <!-- 투자 성향 -->

        <!-- 옵션 리스트 (정기예금 상세) -->
        <collection property="optionList" ofType="org.scoula.product.dto.TimeDepositsDetailDto$DetailOptionList"
                    resultMap="detailOptionMap"/>
    </resultMap>

    <!-- 정기예금 상세 옵션 ResultMap -->
    <resultMap id="detailOptionMap" type="org.scoula.product.dto.TimeDepositsDetailDto$DetailOptionList">
        <result column="save_trm" property="saveTrm"/> <!-- 저축 기간 -->
        <result column="intr_rate_type_nm" property="intrRateTypeNm"/> <!-- 금리 유형명 -->
        <result column="intr_rate" property="intrRate"/> <!-- 기본 금리 -->
        <result column="intr_rate2" property="intrRate2"/> <!-- 최고 금리 -->
    </resultMap>


    <!-- 상세정보에서 쓰일 쿼리문 -->
    <select id="findTimeDepositByFinPrdtCd" resultMap="timeDepositDetailMap">
        SELECT fin_prdt_cd,
               fin_prdt_category,
               fin_prdt_nm,
               rec_reason,
               kor_co_nm,
               prdt_feature,
               description,
               join_way,
               mtrt_int,
               spcl_cnd,
               join_deny,
               join_member,
               etc_note,
               max_limit,
               tendency
        FROM fin_prdt
        WHERE fin_prdt_cd = #{finPrdtCd}
    </select>

    <select id="findDetailOptionByFinPrdtCd"
            parameterType="string"
            resultMap="detailOptionMap">
        SELECT save_trm,
               intr_rate_type_nm,
               intr_rate,
               intr_rate2
        FROM fin_prdt_option
        WHERE fin_prdt_cd = #{finPrdtCd}
    </select>

    <!-- 목록에서 쓰일 쿼리문 -->
    <select id="findAllTimeDeposits" resultMap="TimeDepositsDTOMap">
        SELECT fp.fin_prdt_cd,
               fp.fin_prdt_nm,
               fp.prdt_feature
        FROM fin_prdt fp
        WHERE fp.fin_prdt_category = '1' </select>

    <select id="findOptionsByFinPrdtCd" resultMap="OptionListMap">
        SELECT fpo.save_trm,
               fpo.intr_rate,
               fpo.intr_rate2
        FROM fin_prdt_option fpo
        WHERE fpo.fin_prdt_cd = #{finPrdtCd}
    </select>


</mapper>
