<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.scoula.product.mapper.ProductMapper">
    <!-- 예금 상세 조회 -->
    <select id="findDepositByFinPrdtCd" resultMap="depositResultMap">
        SELECT *
        FROM deposit d
                 JOIN deposit_option do ON d.fin_prdt_cd = do.fin_prdt_cd
        WHERE d.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 적금 상세 조회 -->
    <select id="findSavingByFinPrdtCd" resultMap="savingResultMap">
        SELECT *
        FROM saving s
                 JOIN saving_option so ON s.fin_prdt_cd = so.fin_prdt_cd
        WHERE s.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 주담대 상세 조회 -->
    <select id="findMortgageByFinPrdtCd" resultMap="savingResultMap">
        SELECT *
        FROM mortgage m
                 JOIN mortgage_option mo ON m.fin_prdt_cd = mo.fin_prdt_cd
        WHERE m.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 펀드 상세 조회 -->
    <select id="findFundByFinPrdtCd" resultMap="savingResultMap">
        SELECT *
        FROM fund f
                 JOIN fund_option fo ON f.fin_prdt_cd = fo.fin_prdt_cd
        WHERE f.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 금 상세 조회 -->
    <select id="findGoldByFinPrdtCd" resultMap="savingResultMap">
        SELECT *
        FROM gold m
        WHERE m.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 신탁 상세 조회 -->
    <select id="findTrustByFinPrdtCd" resultMap="savingResultMap">
        SELECT *
        FROM trust t
        WHERE t.fin_prdt_cd = #{finPrdtCd};
    </select>

    <!-- 예금 전용 매핑 -->
    <resultMap id="depositResultMap" type="DepositVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <collection property="optionList"
                    ofType="DepositOptionVo" autoMapping="true"/>
    </resultMap>

    <!-- 적금 전용 매핑 -->
    <resultMap id="savingResultMap" type="SavingVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <collection property="optionList"
                    ofType="SavingOptionVo" autoMapping="true"/>
    </resultMap>

    <!-- 주택담보대출 전용 매핑 -->
    <resultMap id="mortgageResultMap" type="MortgageVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <collection property="optionList"
                    ofType="MortgageOptionVo" autoMapping="true"/>
    </resultMap>

    <!-- 금 전용 매핑 -->
    <resultMap id="goldResultMap" type="GoldVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <!-- 금은 옵션 테이블이 없을 수도 있음 -->
    </resultMap>

    <!-- 펀드 전용 매핑 -->
    <resultMap id="fundResultMap" type="FundVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <collection property="optionList"
                    ofType="FundOptionVo" autoMapping="true"/>
    </resultMap>

    <!-- 신탁 전용 매핑 -->
    <resultMap id="trustResultMap" type="TrustVo" extends="allProductResultMap" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
    </resultMap>

    <!-- 상품 매핑 -->
    <resultMap id="allProductResultMap" type="ProductVo" autoMapping="true">
        <id property="finPrdtCd" column="fin_prdt_cd"/>
        <discriminator javaType="string" column="prdt_type">
            <case value="deposit" resultMap="depositResultMap"/>
            <case value="saving" resultMap="savingResultMap"/>
            <case value="mortgage" resultMap="mortgageResultMap"/>
            <case value="gold" resultMap="goldResultMap"/>
            <case value="fund" resultMap="fundResultMap"/>
            <case value="trust" resultMap="trustResultMap"/>
        </discriminator>
    </resultMap>

    <!--모든 상품종류(예금, 적금, 주담, 펀드, 금, 신탁)를  전체검색하기-->
    <select id="findAllProduct" resultMap="allProductResultMap">
        SELECT *
        FROM v_all_products
    </select>

    <!-- 상품 코드로 검색하기 -->
    <select id="findProductDetail" parameterType="String" resultMap="allProductResultMap">
        SELECT *
        FROM v_all_products
        WHERE fin_prdt_cd = #{finPrdtCd}
    </select>


</mapper>
